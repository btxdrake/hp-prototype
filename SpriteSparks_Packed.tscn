[gd_scene load_steps=35 format=3 uid="uid://ccgeobpyr3ptc"]

[ext_resource type="Script" uid="uid://dmiyjquxveryc" path="res://FX/PlaySparks.gd" id="1_07gof"]
[ext_resource type="Texture2D" uid="uid://cb8y3t3cinxii" path="res://FX/SparksSprites.png" id="3_akgl6"]

[sub_resource type="Curve" id="Curve_4orie"]
_data = [Vector2(0.0284553, 0.142857), 0.0, 8.49608, 0, 0, Vector2(0.0894309, 0.89011), 0.0, 0.0, 0, 0, Vector2(0.995935, 0.10989), 0.0, 0.0, 0, 0]
point_count = 3

[sub_resource type="CurveTexture" id="CurveTexture_wv3bt"]
curve = SubResource("Curve_4orie")

[sub_resource type="ParticleProcessMaterial" id="ParticleProcessMaterial_8u4da"]
resource_local_to_scene = true
lifetime_randomness = 0.97
particle_flag_align_y = true
particle_flag_rotate_y = true
angle_min = -360.0
angle_max = 360.0
direction = Vector3(0, 50, 0)
spread = 0.0
gravity = Vector3(0, 0, 0)
scale_min = 0.5
scale_max = 3.0
scale_curve = SubResource("CurveTexture_wv3bt")

[sub_resource type="VisualShaderNodeExpression" id="VisualShaderNodeExpression_07gof"]
size = Vector2(618, 229.385)
expression = "output0 = floor(input0 / 0.9) * 0.25;"

[sub_resource type="VisualShaderNodeVec2Parameter" id="VisualShaderNodeVec2Parameter_eha4p"]
parameter_name = "SpritesheetResolution"

[sub_resource type="VisualShaderNodeFloatOp" id="VisualShaderNodeFloatOp_akgl6"]
default_input_values = [0, 2.0, 1, 0.0]

[sub_resource type="VisualShaderNodeVectorCompose" id="VisualShaderNodeVectorCompose_rf1xn"]
op_type = 0

[sub_resource type="VisualShaderNodeFloatOp" id="VisualShaderNodeFloatOp_xejwd"]
default_input_values = [0, 0.0, 1, 13.0]
operator = 2

[sub_resource type="VisualShaderNodeExpression" id="VisualShaderNodeExpression_7yyd5"]
size = Vector2(469.273, 211.818)
expression = "output0 = floor(input0) / 15.0;"

[sub_resource type="VisualShaderNodeExpression" id="VisualShaderNodeExpression_3j1xm"]
size = Vector2(519.273, 308.182)
expression = "if (time < 1.0){
	timeOutput = time;
}
else {
 timeOutput = time;
}"

[sub_resource type="VisualShaderNodeInput" id="VisualShaderNodeInput_icf14"]
input_name = "color"

[sub_resource type="VisualShaderNodeFloatOp" id="VisualShaderNodeFloatOp_13ra5"]
default_input_values = [0, 0.0, 1, 4.0]
operator = 2

[sub_resource type="VisualShaderNodeTexture" id="VisualShaderNodeTexture_dsngf"]
source = 5

[sub_resource type="VisualShaderNodeTexture2DParameter" id="VisualShaderNodeTexture2DParameter_axhvx"]
parameter_name = "Texture2DParameter"
texture_type = 1
texture_filter = 1

[sub_resource type="VisualShaderNodeUVFunc" id="VisualShaderNodeUVFunc_tdijq"]
default_input_values = [1, Vector2(1, 1), 2, Vector2(0, 0.005)]

[sub_resource type="VisualShaderNodeVectorDecompose" id="VisualShaderNodeVectorDecompose_gkdnl"]
default_input_values = [0, Quaternion(0, 0, 0, 0)]
op_type = 2

[sub_resource type="VisualShaderNodeVectorOp" id="VisualShaderNodeVectorOp_g1sxp"]
operator = 2

[sub_resource type="VisualShaderNodeFloatParameter" id="VisualShaderNodeFloatParameter_behub"]
parameter_name = "GlowLevel"

[sub_resource type="VisualShaderNodeColorOp" id="VisualShaderNodeColorOp_vhx6x"]
default_input_values = [0, Vector3(0, 0, 0), 1, Vector3(0.05, 0.05, 0.05)]

[sub_resource type="VisualShaderNodeColorFunc" id="VisualShaderNodeColorFunc_n3av1"]
expanded_output_ports = [0]
function = 2

[sub_resource type="VisualShaderNodeVectorCompose" id="VisualShaderNodeVectorCompose_4bwdr"]

[sub_resource type="VisualShaderNodeColorFunc" id="VisualShaderNodeColorFunc_2j76y"]
function = 1

[sub_resource type="VisualShaderNodeFloatOp" id="VisualShaderNodeFloatOp_8r51c"]

[sub_resource type="VisualShaderNodeFloatParameter" id="VisualShaderNodeFloatParameter_703n6"]
parameter_name = "hue_shift"

[sub_resource type="VisualShaderNodeInput" id="VisualShaderNodeInput_41qyb"]
input_name = "uv"

[sub_resource type="VisualShaderNodeUVFunc" id="VisualShaderNodeUVFunc_h58c1"]
default_input_values = [1, Vector2(0.25, 0.063), 2, Vector2(0, 0)]
function = 1

[sub_resource type="VisualShaderNodeInput" id="VisualShaderNodeInput_7i5fa"]
input_name = "time"

[sub_resource type="VisualShaderNodeUVFunc" id="VisualShaderNodeUVFunc_4kvpk"]
default_input_values = [1, Vector2(1, 1), 2, Vector2(0.25, 0)]

[sub_resource type="VisualShaderNodeBillboard" id="VisualShaderNodeBillboard_hisd1"]
keep_scale = true

[sub_resource type="VisualShader" id="VisualShader_mvylh"]
resource_local_to_scene = true
code = "shader_type spatial;
render_mode blend_mix, depth_draw_opaque, depth_test_default, cull_back, diffuse_lambert, specular_schlick_ggx;

uniform sampler2D Texture2DParameter : source_color, filter_nearest;
uniform float hue_shift;
uniform float GlowLevel;



void fragment() {
// Input:5
	vec2 n_out5p0 = UV;


// UVFunc:6
	vec2 n_in6p1 = vec2(0.25000, 0.06300);
	vec2 n_in6p2 = vec2(0.00000, 0.00000);
	vec2 n_out6p0 = (n_out5p0 - n_in6p2) * n_in6p1 + n_in6p2;


// Input:25
	vec4 n_out25p0 = COLOR;


// Input:7
	float n_out7p0 = TIME;


// FloatOp:26
	float n_out26p0 = n_out25p0.x * n_out7p0;


	float n_out24p0;
// Expression:24
	n_out24p0 = 0.0;
	{
		if (n_out26p0 < 1.0){
			n_out24p0 = n_out26p0;
		}
		else {
		 n_out24p0 = n_out26p0;
		}
	}


// FloatOp:22
	float n_in22p1 = 13.00000;
	float n_out22p0 = n_out24p0 * n_in22p1;


	float n_out17p0;
// Expression:17
	n_out17p0 = 0.0;
	{
		n_out17p0 = floor(n_out22p0 / 0.9) * 0.25;
	}


// FloatOp:20
	float n_in20p0 = 2.00000;
	float n_out20p0 = n_in20p0 + n_out17p0;


	float n_out23p0;
// Expression:23
	n_out23p0 = 0.0;
	{
		n_out23p0 = floor(n_out22p0) / 15.0;
	}


// VectorCompose:21
	vec2 n_out21p0 = vec2(n_out20p0, n_out23p0);


// UVFunc:8
	vec2 n_in8p1 = vec2(1.00000, 1.00000);
	vec2 n_out8p0 = n_out21p0 * n_in8p1 + n_out6p0;


// UVFunc:37
	vec2 n_in37p1 = vec2(1.00000, 1.00000);
	vec2 n_in37p2 = vec2(0.00000, 0.00500);
	vec2 n_out37p0 = n_in37p2 * n_in37p1 + n_out8p0;


	vec4 n_out3p0;
// Texture2D:3
	n_out3p0 = texture(Texture2DParameter, n_out37p0);


// ColorOp:41
	vec3 n_in41p1 = vec3(0.05000, 0.05000, 0.05000);
	vec3 n_out41p0 = vec3(1.0) - (vec3(1.0) - vec3(n_out3p0.xyz)) * (vec3(1.0) - n_in41p1);


	vec3 n_out42p0;
// ColorFunc:42
	{
		vec3 c = n_out41p0;
		vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
		vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));
		vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));
		float d = q.x - min(q.w, q.y);
		float e = 1.0e-10;
		n_out42p0 = vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);
	}
	float n_out42p1 = n_out42p0.r;
	float n_out42p2 = n_out42p0.g;
	float n_out42p3 = n_out42p0.b;


// FloatParameter:46
	float n_out46p0 = hue_shift;


// FloatOp:45
	float n_out45p0 = n_out42p1 + n_out46p0;


// VectorCompose:43
	vec3 n_out43p0 = vec3(n_out45p0, n_out42p2, n_out42p3);


	vec3 n_out44p0;
// ColorFunc:44
	{
		vec3 c = n_out43p0;
		vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
		vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
		n_out44p0 = c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
	}


// VectorDecompose:38
	float n_out38p0 = n_out3p0.x;
	float n_out38p1 = n_out3p0.y;
	float n_out38p2 = n_out3p0.z;
	float n_out38p3 = n_out3p0.w;


// FloatParameter:40
	float n_out40p0 = GlowLevel;


// VectorOp:39
	vec3 n_out39p0 = n_out44p0 * vec3(n_out40p0);


// Output:0
	ALBEDO = n_out44p0;
	ALPHA = n_out38p3;
	EMISSION = n_out39p0;


}
"
nodes/vertex/2/node = SubResource("VisualShaderNodeBillboard_hisd1")
nodes/vertex/2/position = Vector2(-80, 340)
nodes/fragment/0/position = Vector2(1240, 160)
nodes/fragment/3/node = SubResource("VisualShaderNodeTexture_dsngf")
nodes/fragment/3/position = Vector2(-300, 140)
nodes/fragment/5/node = SubResource("VisualShaderNodeInput_41qyb")
nodes/fragment/5/position = Vector2(-2100, 60)
nodes/fragment/6/node = SubResource("VisualShaderNodeUVFunc_h58c1")
nodes/fragment/6/position = Vector2(-1680, 40)
nodes/fragment/7/node = SubResource("VisualShaderNodeInput_7i5fa")
nodes/fragment/7/position = Vector2(-3100, 640)
nodes/fragment/8/node = SubResource("VisualShaderNodeUVFunc_4kvpk")
nodes/fragment/8/position = Vector2(-780, 60)
nodes/fragment/17/node = SubResource("VisualShaderNodeExpression_07gof")
nodes/fragment/17/position = Vector2(-1760, 300)
nodes/fragment/17/size = Vector2(618, 229.385)
nodes/fragment/17/input_ports = "0,0,input0;1,0,var;"
nodes/fragment/17/output_ports = "0,0,output0;"
nodes/fragment/17/expression = "output0 = floor(input0 / 0.9) * 0.25;"
nodes/fragment/18/node = SubResource("VisualShaderNodeVec2Parameter_eha4p")
nodes/fragment/18/position = Vector2(-2160, 200)
nodes/fragment/20/node = SubResource("VisualShaderNodeFloatOp_akgl6")
nodes/fragment/20/position = Vector2(-1120, 200)
nodes/fragment/21/node = SubResource("VisualShaderNodeVectorCompose_rf1xn")
nodes/fragment/21/position = Vector2(-920, 180)
nodes/fragment/22/node = SubResource("VisualShaderNodeFloatOp_xejwd")
nodes/fragment/22/position = Vector2(-1980, 560)
nodes/fragment/23/node = SubResource("VisualShaderNodeExpression_7yyd5")
nodes/fragment/23/position = Vector2(-1680, 720)
nodes/fragment/23/size = Vector2(469.273, 211.818)
nodes/fragment/23/input_ports = "0,0,input0;"
nodes/fragment/23/output_ports = "0,0,output0;"
nodes/fragment/23/expression = "output0 = floor(input0) / 15.0;"
nodes/fragment/24/node = SubResource("VisualShaderNodeExpression_3j1xm")
nodes/fragment/24/position = Vector2(-2580, 520)
nodes/fragment/24/size = Vector2(519.273, 308.182)
nodes/fragment/24/input_ports = "0,0,time;"
nodes/fragment/24/output_ports = "0,0,timeOutput;"
nodes/fragment/24/expression = "if (time < 1.0){
	timeOutput = time;
}
else {
 timeOutput = time;
}"
nodes/fragment/25/node = SubResource("VisualShaderNodeInput_icf14")
nodes/fragment/25/position = Vector2(-3120, 540)
nodes/fragment/26/node = SubResource("VisualShaderNodeFloatOp_13ra5")
nodes/fragment/26/position = Vector2(-2740, 520)
nodes/fragment/35/node = SubResource("VisualShaderNodeTexture2DParameter_axhvx")
nodes/fragment/35/position = Vector2(-900, 320)
nodes/fragment/37/node = SubResource("VisualShaderNodeUVFunc_tdijq")
nodes/fragment/37/position = Vector2(-520, 60)
nodes/fragment/38/node = SubResource("VisualShaderNodeVectorDecompose_gkdnl")
nodes/fragment/38/position = Vector2(-300, 280)
nodes/fragment/39/node = SubResource("VisualShaderNodeVectorOp_g1sxp")
nodes/fragment/39/position = Vector2(620, 340)
nodes/fragment/40/node = SubResource("VisualShaderNodeFloatParameter_behub")
nodes/fragment/40/position = Vector2(-280, 420)
nodes/fragment/41/node = SubResource("VisualShaderNodeColorOp_vhx6x")
nodes/fragment/41/position = Vector2(-40, 60)
nodes/fragment/42/node = SubResource("VisualShaderNodeColorFunc_n3av1")
nodes/fragment/42/position = Vector2(180, -200)
nodes/fragment/43/node = SubResource("VisualShaderNodeVectorCompose_4bwdr")
nodes/fragment/43/position = Vector2(620, -200)
nodes/fragment/44/node = SubResource("VisualShaderNodeColorFunc_2j76y")
nodes/fragment/44/position = Vector2(900, -140)
nodes/fragment/45/node = SubResource("VisualShaderNodeFloatOp_8r51c")
nodes/fragment/45/position = Vector2(440, -420)
nodes/fragment/46/node = SubResource("VisualShaderNodeFloatParameter_703n6")
nodes/fragment/46/position = Vector2(-140, -320)
nodes/fragment/connections = PackedInt32Array(5, 0, 6, 0, 6, 0, 8, 0, 21, 0, 8, 2, 22, 0, 17, 0, 22, 0, 23, 0, 23, 0, 21, 1, 17, 0, 20, 1, 20, 0, 21, 0, 24, 0, 22, 0, 25, 0, 26, 0, 26, 0, 24, 0, 35, 0, 3, 2, 7, 0, 26, 1, 8, 0, 37, 0, 37, 0, 3, 0, 3, 0, 38, 0, 38, 3, 0, 1, 39, 0, 0, 5, 40, 0, 39, 1, 3, 0, 41, 0, 41, 0, 42, 0, 43, 0, 44, 0, 44, 0, 39, 0, 44, 0, 0, 0, 42, 1, 45, 0, 45, 0, 43, 0, 42, 2, 43, 1, 42, 3, 43, 2, 46, 0, 45, 1)

[sub_resource type="ShaderMaterial" id="ShaderMaterial_t06m2"]
resource_local_to_scene = true
render_priority = 0
shader = SubResource("VisualShader_mvylh")
shader_parameter/Texture2DParameter = ExtResource("3_akgl6")
shader_parameter/hue_shift = 0.32
shader_parameter/GlowLevel = 2.0

[sub_resource type="QuadMesh" id="QuadMesh_yjs6w"]
resource_local_to_scene = true
material = SubResource("ShaderMaterial_t06m2")
center_offset = Vector3(0, 0.46, 0)

[node name="SpriteSparks" type="Node3D" node_paths=PackedStringArray("particles", "light")]
script = ExtResource("1_07gof")
particles = NodePath("GPUParticles3D")
light = NodePath("GPUParticles3D/OmniLight3D")

[node name="GPUParticles3D" type="GPUParticles3D" parent="."]
transform = Transform3D(1, 0, 0, 0, -4.37114e-08, -1, 0, 1, -4.37114e-08, 0, 3.48353e-08, -0.796938)
amount = 50
lifetime = 0.2
randomness = 1.0
fixed_fps = 12
local_coords = true
process_material = SubResource("ParticleProcessMaterial_8u4da")
draw_pass_1 = SubResource("QuadMesh_yjs6w")

[node name="OmniLight3D" type="OmniLight3D" parent="GPUParticles3D"]
light_color = Color(0.917647, 0.811765, 0.690196, 1)
light_energy = 0.0
